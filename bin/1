+ set -e
++ docker ps --format '{{.Names}} {{.Image}}'
+ local 'images=dpsrv-mongo-latest dpsrv/mongo:latest
dpsrv-nginx-latest dpsrv/nginx:latest
dpsrv-bind-latest dpsrv/bind:latest
dpsrv-scheduler-latest dpsrv/scheduler:latest'
++ dpsrv-iptables-list-ports
++ local comment=dpsrv:forward:port:
++ for iptables in iptables ip6tables
++ echo '# iptables'
++ sudo /sbin/iptables-save
++ grep --color=auto dpsrv:forward:port:
++ for iptables in iptables ip6tables
++ echo '# ip6tables'
++ sudo /sbin/ip6tables-save
++ grep --color=auto dpsrv:forward:port:
+ local 'iptables_ports=# iptables
-A INPUT -p tcp -m comment --comment "dpsrv:forward:port:tcp:27017" -m tcp --dport 27017 -j ACCEPT
-A PREROUTING -d 5.161.71.5/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A PREROUTING -d 5.161.18.3/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A PREROUTING -d 172.17.0.1/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A PREROUTING -d 172.18.0.1/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A OUTPUT -d 127.0.0.1/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A OUTPUT -d 5.161.71.5/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A OUTPUT -d 5.161.18.3/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A OUTPUT -d 172.17.0.1/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
-A OUTPUT -d 172.18.0.1/32 -p tcp -m tcp --dport 27017 -m comment --comment "dpsrv:forward:port:tcp:27017" -j DNAT --to-destination 172.18.0.5:27017
# ip6tables'
+ echo 'dpsrv-mongo-latest dpsrv/mongo:latest
dpsrv-nginx-latest dpsrv/nginx:latest
dpsrv-bind-latest dpsrv/bind:latest
dpsrv-scheduler-latest dpsrv/scheduler:latest'
+ read containerName image
++ echo dpsrv/mongo:latest
++ cut -d: -f1
+ local imageName=dpsrv/mongo
++ echo dpsrv/mongo:latest
++ cut -d: -f2
+ local imageVersion=latest
++ docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' dpsrv-mongo-latest
+ local toAddr=172.18.0.5
++ echo ''
++ grep --color=auto 172.18.0.5
+ local activeAddr=
+ echo 'dpsrv/mongo latest dpsrv-mongo-latest 172.18.0.5 '
dpsrv/mongo latest dpsrv-mongo-latest 172.18.0.5 
+ read containerName image
++ echo dpsrv/nginx:latest
++ cut -d: -f1
+ local imageName=dpsrv/nginx
++ echo dpsrv/nginx:latest
++ cut -d: -f2
+ local imageVersion=latest
++ docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' dpsrv-nginx-latest
+ local toAddr=172.18.0.4
++ echo ''
++ grep --color=auto 172.18.0.4
+ local activeAddr=
+ echo 'dpsrv/nginx latest dpsrv-nginx-latest 172.18.0.4 '
dpsrv/nginx latest dpsrv-nginx-latest 172.18.0.4 
+ read containerName image
++ echo dpsrv/bind:latest
++ cut -d: -f1
+ local imageName=dpsrv/bind
++ echo dpsrv/bind:latest
++ cut -d: -f2
+ local imageVersion=latest
++ docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' dpsrv-bind-latest
+ local toAddr=172.18.0.3
++ echo ''
++ grep --color=auto 172.18.0.3
+ local activeAddr=
+ echo 'dpsrv/bind latest dpsrv-bind-latest 172.18.0.3 '
dpsrv/bind latest dpsrv-bind-latest 172.18.0.3 
+ read containerName image
++ echo dpsrv/scheduler:latest
++ cut -d: -f1
+ local imageName=dpsrv/scheduler
++ echo dpsrv/scheduler:latest
++ cut -d: -f2
+ local imageVersion=latest
++ docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' dpsrv-scheduler-latest
+ local toAddr=172.18.0.2
++ echo ''
++ grep --color=auto 172.18.0.2
+ local activeAddr=
+ echo 'dpsrv/scheduler latest dpsrv-scheduler-latest 172.18.0.2 '
dpsrv/scheduler latest dpsrv-scheduler-latest 172.18.0.2 
+ read containerName image
