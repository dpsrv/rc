+ '[' -n 'dpsrv dpsrv/rc/secrets/letsencrypt/live/domain/ s#^dpsrv/rc/secrets/##g
dpsrv dpsrv/rc/secrets/mongo/conf/ s#^dpsrv/rc/secrets/##g
ezsso dpsrv/rc/secrets/mongo/conf/ s#^dpsrv/rc/secrets/##g
' ]
+ echo 'dpsrv dpsrv/rc/secrets/letsencrypt/live/domain/ s#^dpsrv/rc/secrets/##g
dpsrv dpsrv/rc/secrets/mongo/conf/ s#^dpsrv/rc/secrets/##g
ezsso dpsrv/rc/secrets/mongo/conf/ s#^dpsrv/rc/secrets/##g
'
+ read secret_files_rule
+ '[' -n 'dpsrv dpsrv/rc/secrets/letsencrypt/live/domain/ s#^dpsrv/rc/secrets/##g' ]
+ basename /usr/local/bin/export-files.sh
+ secret_files_rule_file=/tmp/export-files.sh.secret_files_rule.69
+ echo 'dpsrv dpsrv/rc/secrets/letsencrypt/live/domain/ s#^dpsrv/rc/secrets/##g'
+ read -r secret_files_ns secret_files_path secret_files_xform
+ rm /tmp/export-files.sh.secret_files_rule.69
+ find /mnt/data/dpsrv/rc/secrets/letsencrypt/live/domain/ '!' -type d
+ read file
+ echo /mnt/data/dpsrv/rc/secrets/letsencrypt/live/domain/README
+ sed 's#/mnt/data/*##g'
+ secret_path=dpsrv/rc/secrets/letsencrypt/live/domain/README
+ sed 's#^dpsrv/rc/secrets/##g'
+ sed 's#/#-#g'
+ echo dpsrv/rc/secrets/letsencrypt/live/domain/README
+ tr A-Z a-z
+ secret_name=letsencrypt-live-domain-readme
+ kubectl -n dpsrv create secret generic letsencrypt-live-domain-readme '--from-file=/mnt/data/dpsrv/rc/secrets/letsencrypt/live/domain/README' '--dry-run=client' -o yaml
+ kubectl apply -f -
+ grep -v unchanged
+ '[' -n 'dpsrv dpsrv/rc/secrets/redis/redis.env s/^/redis-/g
ezsso ezsso/rc/secrets/dating/.env.local s/^/dating-/g
' ]
+ + read secret_env_rule
echo 'dpsrv dpsrv/rc/secrets/redis/redis.env s/^/redis-/g
ezsso ezsso/rc/secrets/dating/.env.local s/^/dating-/g
'
+ basename /usr/local/bin/export-env.sh
+ secret_env_rule_file=/tmp/export-env.sh.102.secret_env_rule
+ echo 'dpsrv dpsrv/rc/secrets/redis/redis.env s/^/redis-/g'
+ read -r secret_env_ns secret_env_file secret_env_xform
+ rm /tmp/export-env.sh.102.secret_env_rule
+ secret_env_path=/mnt/data/dpsrv/rc/secrets/redis/redis.env
+ cat /mnt/data/dpsrv/rc/secrets/redis/redis.env
+ read secret_env
+ '[' -n 'RI_REDIS_HOST=dpsrv-redis-latest' ]
+ basename /usr/local/bin/export-env.sh
+ secret_env_file=/tmp/export-env.sh.102.secret_env
+ echo 'RI_REDIS_HOST dpsrv-redis-latest'
+ read -r secret_name secret_value
+ rm /tmp/export-env.sh.102.secret_env
+ '[' -n dpsrv-redis-latest ]
+ eval echo dpsrv-redis-latest
+ echo dpsrv-redis-latest
+ secret_value=dpsrv-redis-latest
+ '[' -z s/^/redis-/g ]
+ sed s/^/redis-/g
+ echo RI_REDIS_HOST
+ secret_name=redis-RI_REDIS_HOST
+ echo redis-RI_REDIS_HOST
+ tr A-Z_ a-z-
+ secret_name=redis-ri-redis-host
+ kubectl -n dpsrv create secret generic redis-ri-redis-host '--from-literal=redis-ri-redis-host=dpsrv-redis-latest' '--dry-run=client' -o yaml
+ tee /tmp/redis-ri-redis-host
apiVersion: v1
data:
  redis-ri-redis-host: ZHBzcnYtcmVkaXMtbGF0ZXN0
kind: Secret
metadata:
  name: redis-ri-redis-host
  namespace: dpsrv
+ cat /tmp/redis-ri-redis-host
+ envsubst
+ tee /tmp/redis-ri-redis-host.1
apiVersion: v1
data:
  redis-ri-redis-host: ZHBzcnYtcmVkaXMtbGF0ZXN0
kind: Secret
metadata:
  name: redis-ri-redis-host
  namespace: dpsrv
+ kubectl apply -f -
+ cat /tmp/redis-ri-redis-host.1
+ grep -v unchanged
